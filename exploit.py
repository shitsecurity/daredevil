#!/usr/bin/env python

import sync
import copy
import logging

def exploit(context, 
            search, 
            query, 
            fetch,
            args,
            pool=None,
            workers=10,
            offset=1,
            length=16):

    pool = pool or sync.Pool(workers)
    def leet(index):
        try:
            ctx = copy.copy(context)
            ctx.index = index
            return search(query, fetch, ctx, args)
        except Exception, e:
            logging.debug(e.message)
            return ''
    return pool.map(leet, xrange(offset, offset+length))
